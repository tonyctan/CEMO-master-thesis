TITLE:
    M4: Financial literacy 3-level


DATA:
    file = "C:\Users\Admin\implist.dat";

    type = imputation;


VARIABLE:
    names =
        FKI CNTRYID CNTSCHID CNTSTUID W_STU
        MATH READ FLIT                      ! PISA achievement variables
        MALE IMMI1GEN IMMI2GEN ESCS         ! Demographic info
        FCFMLRTY FLCONFIN                   ! Affect
        FLSCHOOL                            !   Lat var "Academic"
        NOBULLY                             !   Lat var "Safety"
        FLFAMILY                            !   Lat var "Community"
        W_SCH STRATIO                       ! School character
        EDUSHORT                            !   Lat var "inst. env."
        ;
    
    usev =
        FLIT                                ! Financial literacy outcome
        FLSCHOOL                            !   "Academic"
        NOBULLY                             !   "Safety"
        FLFAMILY                            !   "Community" (Financial socialisation)
        EDUSHORT STRATIO                    !   "Institutional environment"
        FCFMLRTY FLCONFIN                   ! L1 mediators
        MALE IMMI1GEN IMMI2GEN ESCS         ! L1 control vars
        FKI                                 ! L3 predictor
        ;

    cluster =
        CNTRYID                             ! L3: country
        CNTSCHID                            ! L2: school
        ;

    ! Vars that ONLY appear in L1
    within =
        FCFMLRTY FLCONFIN
        MALE IMMI1GEN IMMI2GEN ESCS
        ;

    ! Vars that ONLY appear in L2 and L3
    between =
        (CNTRYID) FKI                       ! L3: country
        (CNTSCHID) EDUSHORT STRATIO         ! L2: school
        ;

    missing = all (-99);

    weight = W_STU;                         ! Student weight
    b2weight = W_SCH;                       ! School weight


ANALYSIS:
    processors = 16;

    type = threelevel;


MODEL:

%Within%                                    ! === L1: Student-level ===

    ! Indirect pathways (1st half): school climate vars onto mediators
        ! Onto mediator FAMILIARITY
    FCFMLRTY on FLSCHOOL NOBULLY FLFAMILY;
        ! Onto mediator CONFIDENCE
    FLCONFIN on FLSCHOOL NOBULLY FLFAMILY;

    ! Total effect
    FLIT on
        ! Direct pathways: school climate vars onto financial literacy
        FLSCHOOL NOBULLY FLFAMILY
        ! Indirect pathways (2nd half): affective vars onto financial literacy
        FCFMLRTY FLCONFIN
        ! Control vars (demographic info)
        MALE IMMI1GEN IMMI2GEN ESCS
        ;

    ! Covariances
        ! Between school climate vars
    FLSCHOOL with NOBULLY;
    FLSCHOOL with FLFAMILY;
    NOBULLY with FLFAMILY;
        ! Between mediators
    FCFMLRTY with FLCONFIN;

%Between CNTSCHID%                          ! === L2: School-level ===

    FLIT on
        FLSCHOOL NOBULLY FLFAMILY EDUSHORT  ! Input vars (school climate vars)
        STRATIO                             ! Control var (student-teacher ratio)
        ;

    ! Covariances
    FLSCHOOL with NOBULLY;
    NOBULLY with FLFAMILY;
    FLFAMILY with EDUSHORT;

    FLSCHOOL with FLFAMILY;
    NOBULLY with EDUSHORT;

    FLSCHOOL with EDUSHORT;

%Between CNTRYID%                           ! === L3: Country-level ===
    FLIT on
        FKI                                 ! Financial knowledge indices
        ;

OUTPUT:
    sampstat stdyx;
